<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>온라인 지렁이 배틀</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="app">
      <header class="app__header">
        <h1>온라인 지렁이 배틀</h1>
        <div class="status" id="connection-status">서버 연결 대기중...</div>
        <div class="header-actions">
          <button id="toggle-audio" class="btn btn--ghost">🔊 사운드 켜기</button>
          <button id="request-replay" class="btn btn--ghost" disabled>🎞 리플레이</button>
        </div>
      </header>

      <main class="app__main">
        <aside class="panel panel--lobby">
          <section class="panel__section">
            <h2>플레이어 정보</h2>
            <label class="field">
              <span>닉네임</span>
              <input id="player-name" maxlength="16" placeholder="지렁군" />
            </label>
            <div class="field">
              <span>지렁이 색상</span>
              <div class="color-palette" id="color-palette">
                <button type="button" data-color="#ff4d4f" aria-label="빨강"></button>
                <button type="button" data-color="#40a9ff" aria-label="파랑"></button>
                <button type="button" data-color="#52c41a" aria-label="초록"></button>
                <button type="button" data-color="#faad14" aria-label="노랑"></button>
                <button type="button" data-color="#9254de" aria-label="보라"></button>
                <button type="button" data-color="#fa541c" aria-label="주황"></button>
                <button type="button" data-color="#eb2f96" aria-label="분홍"></button>
                <button type="button" data-color="#13c2c2" aria-label="청록"></button>
              </div>
              <div class="color-preview" id="color-preview">선택 색상</div>
            </div>
            <label class="field">
              <span>효과음 볼륨</span>
              <div class="volume-control">
                <input id="sfx-volume" type="range" min="0" max="100" step="5" />
                <span class="volume-control__value" id="sfx-volume-value">70%</span>
              </div>
              <small class="field__hint">채팅/시스템 알림음 크기를 조절합니다</small>
            </label>
            <div class="field field--stacked">
              <span>접근성 옵션</span>
              <label class="field__option">
                <input id="accessibility-contrast" type="checkbox" />
                <span>파워업 HUD 고대비 모드</span>
              </label>
              <label class="field__option">
                <input id="accessibility-colorblind" type="checkbox" />
                <span>색각 보조 패턴 표시</span>
              </label>
              <small class="field__hint">HUD 대비와 패턴을 조절해 가독성을 높입니다</small>
            </div>
            <div class="field-row">
              <button id="quick-join" class="btn btn--primary">빠른 입장</button>
              <button id="create-room" class="btn btn--secondary">방 만들기</button>
            </div>
            <label class="field">
              <span>게임 모드</span>
              <select id="game-mode"></select>
              <small class="field__hint" id="mode-description"></small>
            </label>
            <label class="field">
              <span>비공개 방</span>
              <input id="private-room-toggle" type="checkbox" />
            </label>
            <label class="field">
              <span>방 검색</span>
              <div class="field-row">
                <input id="room-id" placeholder="방 코드" />
                <button id="join-room" class="btn btn--secondary">입장</button>
              </div>
            </label>
          </section>

          <section class="panel__section">
            <div class="section-header">
              <h2>공개 방</h2>
              <button id="refresh-rooms" class="btn btn--ghost">새로고침</button>
            </div>
            <ul id="room-list" class="room-list empty">
              <li>참여 가능한 방이 없습니다.</li>
            </ul>
          </section>

          <section class="panel__section panel__section--stats">
            <div class="section-header">
              <h2>랭킹</h2>
              <span id="stats-updated">-</span>
            </div>
            <table class="stats-table" id="stats-table">
              <thead>
                <tr>
                  <th>플레이어</th>
                  <th>승률</th>
                  <th>평균 점수</th>
                  <th>평균 생존</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="4" class="empty">통계 데이터를 불러오는 중...</td>
                </tr>
              </tbody>
            </table>
          </section>
        </aside>

        <section class="panel panel--game">
          <div class="canvas-container">
            <canvas id="game-canvas" width="1600" height="900"></canvas>
            <div class="game-overlay hidden" id="game-overlay"></div>
            <div class="countdown" id="countdown"></div>
            <div class="mobile-controls" id="mobile-controls">
              <div class="mobile-stick" id="mobile-stick">
                <div class="mobile-stick__handle" id="mobile-stick-handle"></div>
              </div>
              <p class="mobile-controls__hint">드래그하여 이동하세요</p>
            </div>
            <div class="spectator-panel is-hidden" id="spectator-panel">
              <div class="spectator-panel__header">
                <div class="spectator-panel__title">
                  <span>관전자 HUD</span>
                  <small id="spectator-status">관전 대상 없음</small>
                </div>
                <div class="spectator-panel__controls">
                  <button id="spectator-prev" class="btn btn--ghost btn--tiny" type="button" aria-label="이전 플레이어">
                    ◀
                  </button>
                  <button id="spectator-next" class="btn btn--ghost btn--tiny" type="button" aria-label="다음 플레이어">
                    ▶
                  </button>
                  <button id="spectator-lock" class="btn btn--ghost btn--tiny" type="button" aria-pressed="false">
                    자동 추적
                  </button>
                </div>
              </div>
              <div class="spectator-panel__targets" id="spectator-targets">
                <p class="empty">관전 가능한 플레이어가 없습니다.</p>
              </div>
              <div class="spectator-panel__cameras" id="spectator-cameras">
                <div class="empty">관전 가능한 지렁이를 기다리는 중...</div>
              </div>
            </div>
          </div>
          <div class="hud">
            <div class="hud__section">
              <h3>현재 생존</h3>
              <ul id="alive-list" class="pill-list"></ul>
            </div>
            <div class="hud__section">
              <h3>점수판</h3>
              <table class="scoreboard" id="scoreboard">
                <thead>
                  <tr>
                    <th>플레이어</th>
                    <th>점수</th>
                    <th>킬</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="3" class="empty">게임에 참여하세요!</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="hud__section hud__section--events">
              <h3>실시간 이벤트</h3>
              <ul id="event-feed" class="event-feed" aria-live="polite">
                <li class="empty">전투 이벤트가 여기에 표시됩니다.</li>
              </ul>
            </div>
            <div class="hud__section hud__section--tournament is-hidden" id="tournament-section">
              <h3>토너먼트</h3>
              <div class="tournament__meta">
                <span id="tournament-rounds">라운드 -</span>
                <span id="tournament-timer"></span>
              </div>
              <ul id="tournament-wins" class="badge-list"></ul>
              <div class="tournament__highlights">
                <h4>라운드 하이라이트</h4>
                <div class="tournament__round-summary">
                  <h5>라운드 요약</h5>
                  <ul id="tournament-round-summary" class="round-summary-list">
                    <li class="empty">라운드 기록이 준비되면 여기에 표시됩니다.</li>
                  </ul>
                </div>
                <div class="highlight-controls">
                  <div class="highlight-controls__search">
                    <input
                      id="highlight-search"
                      type="search"
                      placeholder="제목 또는 플레이어 검색"
                      autocomplete="off"
                    />
                  </div>
                  <div class="highlight-controls__actions">
                    <div id="highlight-tag-filters" class="highlight-tag-filters">
                      <button type="button" data-tag="kill" class="tag-filter" aria-pressed="false">킬</button>
                      <button type="button" data-tag="powerup" class="tag-filter" aria-pressed="false">파워업</button>
                      <button type="button" data-tag="golden" class="tag-filter" aria-pressed="false">골든</button>
                      <button type="button" data-tag="round-end" class="tag-filter" aria-pressed="false">라운드</button>
                    </div>
                    <div class="highlight-controls__import">
                      <input id="highlight-import-input" type="file" accept="application/json" hidden />
                      <button id="highlight-import-button" type="button" class="btn btn--ghost btn--tiny">
                        JSON 가져오기
                      </button>
                    </div>
                  </div>
                </div>
                <div id="highlight-summary" class="highlight-summary">데이터를 기다리는 중...</div>
                <div class="highlight-recommendations" id="highlight-recommendations">
                  <div class="highlight-recommendations__header">
                    <h5>추천 하이라이트</h5>
                  </div>
                  <ul id="highlight-recommendation-list" class="highlight-recommendations__list">
                    <li class="empty">추천을 준비하는 중...</li>
                  </ul>
                </div>
                <ul id="tournament-highlights" class="highlight-list">
                  <li class="empty">하이라이트가 준비되면 여기에 표시됩니다.</li>
                </ul>
                <div class="favorite-highlights">
                  <div class="favorite-highlights__header">
                    <h4>즐겨찾은 클립</h4>
                    <button id="clear-highlight-favorites" class="btn btn--ghost btn--tiny" type="button">
                      전체 비우기
                    </button>
                  </div>
                  <ul id="favorite-highlights" class="highlight-list highlight-list--favorites">
                    <li class="empty">즐겨찾은 클립이 없습니다.</li>
                  </ul>
                </div>
                <div class="highlight-import-report" id="highlight-import-report">
                  <div class="highlight-import-report__header">
                    <h4>최근 임포트 리포트</h4>
                  </div>
                  <ul id="highlight-import-log" class="highlight-import-report__list">
                    <li class="empty">아직 리포트가 없습니다.</li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="hud__section">
              <h3>내 상태</h3>
              <ul id="player-effects" class="badge-list"></ul>
              <ul id="player-profile" class="profile-list">
                <li><span>게임 수</span><strong>-</strong></li>
                <li><span>승률</span><strong>-</strong></li>
                <li><span>평균 점수</span><strong>-</strong></li>
                <li><span>최고 점수</span><strong>-</strong></li>
              </ul>
              <div id="player-status" class="player-status">대기 중</div>
            </div>
          </div>
        </section>

        <aside class="panel panel--meta">
          <section class="panel__section notifications">
            <h2>알림</h2>
            <ul id="notification-list" class="notification-list"></ul>
          </section>
          <section class="panel__section achievements">
            <h2>라운드 업적</h2>
            <ul id="achievement-list" class="achievement-list">
              <li class="empty">게임 종료 후 업적을 확인하세요.</li>
            </ul>
          </section>
          <section class="panel__section chat">
            <h2>채팅</h2>
            <div id="chat-log" class="chat__log"></div>
            <form id="chat-form" class="chat__input" autocomplete="off">
              <input id="chat-message" placeholder="메시지를 입력하세요" maxlength="140" />
              <button class="btn btn--primary" type="submit">전송</button>
            </form>
          </section>
          <section class="panel__section help">
            <h2>조작법</h2>
            <ul class="help__list">
              <li>이동: ← → ↑ ↓ 또는 WASD</li>
              <li>사운드: 상단 버튼으로 토글</li>
              <li>리플레이: 게임 종료 후 시청 가능</li>
              <li>채팅: 메시지 입력 후 Enter</li>
            </ul>
          </section>
        </aside>
      </main>

      <footer class="app__footer">
        <span id="mode-indicator">모드: 로비</span>
        <span id="world-info">맵: 1600 x 900</span>
        <span id="build-info">빌드 v1.0.0</span>
      </footer>
    </div>

    <div class="modal hidden" id="replay-modal">
      <div class="modal__content">
        <header class="modal__header">
          <h2>리플레이</h2>
          <button id="close-replay" class="btn btn--ghost">닫기</button>
        </header>
        <p class="modal__hint">재생 속도와 구간을 조절해 지난 경기를 다시 확인하세요.</p>
        <div class="replay__controls">
          <button id="replay-play" class="btn btn--primary">재생</button>
          <button id="replay-pause" class="btn btn--secondary">일시정지</button>
          <label class="field">
            <span>재생 속도</span>
            <input id="replay-speed" type="range" min="0.25" max="2" step="0.25" value="1" />
          </label>
          <label class="field">
            <span>타임라인</span>
            <div class="replay-timeline" id="replay-timeline">
              <p id="replay-timeline-instructions" class="sr-only">
                타임라인 마커에 포커스가 있을 때 왼쪽과 오른쪽 화살표로 이전/다음 마커로 이동하고,
                Home과 End 키로 처음과 끝 마커로 이동할 수 있습니다. 엔터 또는 스페이스 키를 눌러 해당 시점으로 즉시 이동합니다.
              </p>
              <div
                class="replay-timeline__markers"
                id="replay-timeline-markers"
                role="group"
                aria-label="리플레이 주요 이벤트"
                aria-describedby="replay-timeline-instructions"
              ></div>
              <div id="replay-marker-status" class="sr-only" aria-live="polite"></div>
              <input id="replay-progress" type="range" min="0" max="1" step="0.01" value="0" />
            </div>
          </label>
        </div>
        <canvas id="replay-canvas" width="1600" height="900"></canvas>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="/js/app.js"></script>
  </body>
</html>
