# 온라인 지렁이 배틀 (Online Worm Battle)

실시간으로 최대 8명이 함께 즐기는 HTML5 캔버스 기반 지렁이 배틀 게임입니다. 성장과 충돌, 파워업, 채팅, 리플레이까지 한 곳에 모은 브라우저 멀티플레이 경험을 제공합니다.

## 주요 특징
- 🔄 **실시간 멀티플레이**: Socket.IO 기반으로 부드러운 20TPS 동기화
- 🎯 **다양한 게임 모드**: 클래식/배틀/스피드/토너먼트 규칙을 즉시 전환
- 🪱 **성장 시스템**: 음식을 먹을수록 몸이 길어지고, 골든 음식은 큰 보너스를 제공합니다
- ⚔️ **전략적 전투**: 벽이나 상대 지렁이와의 충돌에 주의하며 최후까지 생존하세요
- 🧰 **파워업**: 속도 증가, 무적, 작아지기 아이템으로 전세를 뒤집을 수 있습니다
- 🧑‍🎨 **커스터마이징**: 로비에서 원하는 지렁이 색상을 선택하고 게임 중에도 안전 구간에서 변경 가능합니다
- 📱 **모바일 대응**: 가상 조이스틱과 반응형 레이아웃으로 터치 환경에서도 전투 가능
- ⏱ **생존 보너스**: 오래 버틸수록 라운드 종료 시 추가 점수를 획득합니다
- ✨ **파티클 연출**: 음식 섭취·사망·파워업 상황을 실시간 시각 효과로 피드백
- 💬 **커뮤니케이션**: 실시간 채팅과 시스템 알림, 경기후 리플레이 지원
- 🎞 **토너먼트 하이라이트**: 라운드 종료와 함께 핵심 장면을 자동 편집하여 리플레이 모달에서 즉시 시청
- 📊 **랭킹 & 통계**: 승리 횟수, 평균 점수, 생존 시간 기반으로 글로벌 통계 제공
- 📇 **개인 프로필**: MongoDB에 저장된 누적 전적을 불러와 내 상태 패널에서 즉시 확인

## 빠른 시작
```bash
npm install
# (선택) MongoDB를 사용하려면 아래 환경 변수를 설정하세요
# export MONGODB_URI="mongodb+srv://user:password@cluster.mongodb.net/?retryWrites=true&w=majority"
# export MONGODB_DB="online_worm_battle"
# export MONGODB_COLLECTION="player_stats"
npm start
```

서버는 기본적으로 `http://localhost:3000` 에서 실행됩니다. 동일한 네트워크의 다른 브라우저도 접속하면 함께 플레이할 수 있습니다.

## 게임 플레이
- **참여 방법**: 닉네임을 적고 빠른 입장 또는 방 생성/참여를 선택합니다
- **모드 선택**: 방 생성 시 원하는 게임 모드를 고르고, 빠른 입장 시에도 선호 모드를 지정할 수 있습니다
- **조작법**: 방향키 또는 WASD로 이동합니다 (대각선 이동 불가)
- **모바일 조작**: 화면 좌측 하단 가상 조이스틱을 드래그하여 이동합니다
- **목표**: 음식을 먹어 성장하고, 다른 지렁이를 따돌려 최후의 생존자가 되세요
- **게임 오버**: 자신의 몸, 다른 지렁이, 혹은 벽에 부딪히면 탈락합니다. 이후에는 관전 모드로 전환됩니다.
- **커스터마이징**: 좌측 로비 패널의 팔레트에서 색상을 선택하면 즉시 적용되며, 경기 전에는 즉시 바꿀 수 있습니다.
- **생존 보너스**: 생존 시간 1초마다 모드별 보너스 점수가 누적되어 라운드 종료 시 자동 반영됩니다.

## 게임 모드
| 모드 | 특징 | 추천 플레이 |
| --- | --- | --- |
| 클래식 | 표준 속도와 밸런스, 30개의 음식 스폰 | 첫 플레이 또는 정석 대결 |
| 배틀 | 음식·파워업 다량 등장, 빠른 성장 | 아이템 난전과 역전 플레이 |
| 스피드 | 기본 이동 속도 상향, 빠른 공방 | 순발력과 회피 능력 테스트 |
| 토너먼트 | 3승 선착의 라운드제, 라운드 간 인터미션 | 장기전과 팀 응원, 스트리밍 이벤트 |

## 인터페이스 요약
- **로비 패널**: 방 목록, 방 생성/참가, 플레이어 통계 확인
- **게임 패널**: 캔버스 렌더링, 실시간 점수판, 생존자 목록, 내 상태/버프 표시
- **메타 패널**: 시스템 알림, 채팅, 기본 조작 가이드
- **토너먼트 패널**: 라운드 진행 상황, 목표 승수, 다음 라운드 타이머를 한눈에 파악
- **리플레이 모드**: 경기 종료 후 상단 버튼으로 요청, 속도 조절과 타임라인 탐색 지원
- **사운드**: 기본 BGM과 먹이 섭취/사망/우승 효과음 탑재 (사용자 토글 가능)

## 기술 스택
- **프론트엔드**: HTML5 Canvas, 모듈형 JavaScript, CSS Grid/Flex
- **백엔드**: Node.js, Express, Socket.IO, UUID
- **데이터**: In-memory 룸/플레이어 상태 + MongoDB 연동을 염두에 둔 설계 (현재 서버 런타임 통계 저장)

## 개발 참고
- `server.js` 에서 게임 월드 규격, 파워업 지속시간, 점수 체계 등을 중앙 관리합니다
- `/public/js/app.js` 는 상태, 렌더러, UI, 입력, 네트워크 모듈을 조립하는 진입점입니다
- `/public/js/core` 폴더에 상태 관리, 렌더러, UI, 입력 컨트롤러, 네트워크 이벤트가 분리돼 있어 컴포넌트 단위 확장이 쉽습니다
- `InputManager` 가 키보드와 모바일 가상 조이스틱 이벤트를 단일 인터페이스로 추상화하여 플랫폼 별 입력 처리 코드를 단순화합니다
- `/api/stats` 엔드포인트로 현재까지의 글로벌 통계를 JSON 으로 확인할 수 있습니다
- `/api/profile/:name` 엔드포인트로 특정 플레이어의 누적 전적을 불러올 수 있습니다 (MongoDB 연결 시 영구 저장)
- 개발 중에는 `npm run dev` 로 nodemon 감시 실행이 가능합니다

## 환경 변수
- `MONGODB_URI`: MongoDB 연결 문자열. 설정하지 않으면 서버 메모리에 통계를 보관합니다.
- `MONGODB_DB`: 사용할 데이터베이스 이름 (기본값 `online_worm_battle`).
- `MONGODB_COLLECTION`: 플레이어 통계를 저장할 컬렉션 이름 (기본값 `player_stats`).

MongoDB가 연결되면 게임 종료 시 각 플레이어의 점수/생존/킬/선호 색상이 자동으로 영구 저장되고, 로비의 **내 상태** 영역과 REST API를 통해 즉시 확인할 수 있습니다.

## 향후 아이디어
- 통합 계정/친구 초대 시스템 연동
- 토너먼트 하이라이트 자동 리플레이 생성
- 관전/중계용 멀티 POV HUD 및 해설 도구
- 파워업 밸런싱/선호도 대시보드와 분석 리포트
- 커스텀 룰(맵 크기, 파워업 빈도) 설정 옵션

즐거운 지렁이 배틀 되세요! 🐛
